{% extends "base.html" %}
{% load static %}

{% block page_header %}{% endblock %}

{% block content %}
<!-- Pointy Star SVG Definition (for featured products ratings) -->
<svg style="display: none;">
    <symbol id="star-pointy" viewBox="0 0 24 24">
      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
    </symbol>
</svg>

<!-- Full-width Vimeo video hero -->
<section class="hero hero--video video-custom">
  <div style="position: relative; width: 100%; height: 66vh; overflow: hidden;">
    <iframe 
      title="Birchlin Hero Video - Outdoor camping adventure"
      src="https://player.vimeo.com/video/1111856401?autoplay=1&loop=1&muted=1&background=1&controls=0&quality=720p"
      style="position: absolute; top: 50%; left: 50%; width: 100vw; height: 56.25vw; min-height: 100%; min-width: 177.77vh; transform: translate(-50%, -50%); border: 0;"
      allow="autoplay; fullscreen"
      loading="lazy">
    </iframe>
  </div>

  <!-- Fixed overlay positioning to prevent layout shift -->
  <div class="hero__overlay">
    <div style="pointer-events: auto;" class="container">
      <p class="hero__eyebrow" style="margin: 0 0 6px; font-weight: 600; opacity: 0.9; color: white; font-size: 14px;">What you bring is just the beginning</p>
      <h1 class="hero__title" style="margin: 0 0 14px; font-weight: 800; line-height: 1.05; font-size: clamp(28px, 4.6vw, 56px); color: white;">Unpacked Adventures</h1>
      <a href="{% url 'products' %}" class="btn-hero" style="display: inline-flex; align-items: center; gap: 10px; padding: 12px 18px; border-radius: 12px; border: 1px solid #fff; color: #fff; text-decoration: none; background: transparent; font-weight: 700; max-width: 300px; min-height: 48px;">
        Explore all products<i class="fas fa-arrow-right" style="margin-left: 8px; transition: transform 0.3s ease;" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</section>

<!-- Feature Sections -->
<section class="feature-sections" style="padding: 60px 0;">
  <div class="container">
    <div class="row" style="gap: 0px;">
      
      <!-- Shelter Feature Section -->
      <div class="col-lg-6" style="flex: 1;">
        <div class="feature-card" style="position: relative; height: 400px; overflow: hidden; background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); display: flex; align-items: center; justify-content: flex-start; border-radius: 12px;">
          
          <!-- Background Image Placeholder (will be replaced with Sora-generated image) -->
          <div class="feature-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('{% static "images/20250915_2050_dusk-mountain.jpg" %}'); background-size: cover; background-position: center; background-repeat: no-repeat; z-index: 1; border-radius: 12px;"></div>
          
          <!-- Content Overlay -->
          <div class="feature-content" style="position: relative; z-index: 2; padding: 40px; color: white; max-width: 400px;">

            
            <!-- Header -->
            <h3 style="font-size: clamp(24px, 3.5vw, 32px); font-weight: 700; letter-spacing: -0.5px; margin: 0 0 12px; line-height: 1.2; text-transform: uppercase;">
              SHELTER THE<br>ADVENTURE
            </h3>
            
            <!-- Subtext -->
            <p style="font-size: 16px; line-height: 1.4; margin: 0 0 24px; opacity: 0.9; font-weight: 400;">
              Premium tents and shelters built for every expedition
            </p>
            
            <!-- CTA Button -->
            <a href="{% url 'products' %}?category=tents_and_shelter" class="btn" style="display: inline-flex; align-items: center; gap: 8px; background: white; color: #2c3e50; padding: 12px 20px; border-radius: 6px; text-decoration: none; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s ease;" onmouseover="this.style.background='#f8f9fa'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='white'; this.style.transform='translateY(0)'">
              EXPLORE SHELTERS
              <i class="fas fa-arrow-right" style="font-size: 12px;" aria-hidden="true"></i>
            </a>
          </div>
        </div>
      </div>
      
      <!-- Navigation Feature Section -->
      <div class="col-lg-6" style="flex: 1;">
        <div class="feature-card" style="position: relative; height: 400px; overflow: hidden; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); display: flex; align-items: center; justify-content: flex-start; border-radius: 12px;">
          
          <!-- Background Image Placeholder (will be replaced with Sora-generated image) -->
          <div class="feature-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('{% static "images/pexels-justguryan-19945156.jpg" %}'); background-size: cover; background-position: center; background-repeat: no-repeat; z-index: 1; border-radius: 12px;"></div>
          
          <!-- Content Overlay -->
          <div class="feature-content" style="position: relative; z-index: 2; padding: 40px; color: white; max-width: 400px;">
          
            
            <!-- Header -->
            <h3 style="font-size: clamp(24px, 3.5vw, 32px); font-weight: 700; letter-spacing: -0.5px; margin: 0 0 12px; line-height: 1.2; text-transform: uppercase;">
              NEVER LOSE<br>YOUR WAY
            </h3>
            
            <!-- Subtext -->
            <p style="font-size: 16px; line-height: 1.4; margin: 0 0 24px; opacity: 0.9; font-weight: 400;">
              Professional navigation gear for confident exploration
            </p>
            
            <!-- CTA Button -->
            <a href="{% url 'products' %}?category=navigation" class="btn" style="display: inline-flex; align-items: center; gap: 8px; background: white; color: #2c3e50; padding: 12px 20px; border-radius: 6px; text-decoration: none; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s ease;" onmouseover="this.style.background='#f8f9fa'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='white'; this.style.transform='translateY(0)'">
              SHOP NAVIGATION
              <i class="fas fa-arrow-right" style="font-size: 12px;" aria-hidden="true"></i>
            </a>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</section>
      
     

<!-- Mobile Responsive Styles -->
<style>

.video-custom {

  position: relative; width: 100vw;
  left: 50%; right: 50%;
  margin-left: -50vw;
  margin-right: -50vw; overflow: hidden;
  background: #000; min-height: 56vh;
}


/* ====== FULL-WIDTH VIDEO HERO (Thule-style) ====== */

/* full-bleed even if placed inside a .container */
.hero {
  position: relative;
  width: 100vw;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
  overflow: hidden;
  background: #000;
}

/* soft dark gradient so white text pops near the bottom */
.hero__overlay {
  position: absolute; top: 0; left: 0; 
  width: 100%; height: 100%; 
  display: flex;
  flex-direction: column; 
  justify-content: flex-end; 
  background: linear-gradient(180deg, rgba(0,0,0,0) 40%, rgba(0,0,0,.55) 100%); 
  z-index: 3; pointer-events: none;
  inset: 0;
  padding: clamp(16px, 6vw, 56px);
  color: #fff;
}

.hero__overlay div {
  margin-bottom: 50px;

}

/* text */
.hero__eyebrow {
  margin: 0 0 6px;
  font-weight: 600;
  opacity: .9;
}
.hero__title {
  margin: 0 0 14px;
  font-weight: 800;
  line-height: 1.05;
  font-size: clamp(28px, 4.6vw, 56px);
}

/* CTA button (white outline, subtle hover) */
.btn-hero {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: 12px;
  border: 1px solid #fff;
  color: #fff !important;
  text-decoration: none;
  background: transparent;
  font-weight: 700;
  max-width: 300px;
}
.btn-hero:hover { background: rgba(255,255,255,.12); }


/* Feature sections mobile responsiveness */
@media (max-width: 768px) {
  
  .video-custom iframe{

  left: 0 !important;
  }


  .hero__overlay div {
    margin-bottom: 90px;

  }
  .feature-sections .row {
    flex-direction: column !important;
    gap: 20px !important;
  }
  
  .feature-sections .col-lg-6 {
    flex: none !important;
    max-width: 100% !important;
  }
  
  .feature-sections .feature-card {
    height: 300px !important;
  }
  
  .feature-sections .feature-content {
    padding: 30px !important;
  }
}

@media (max-width: 991px) {
  .feature-sections .feature-card {
    height: 350px !important;
  }
  .feature-sections .feature-content {
    padding: 35px !important;
  }
}
</style>

<!-- Featured Products Section -->
{% if featured_products %}
<section class="featured-products" style="padding: 50px 0 80px; background: #fff;">
  <div class="container">
    <div class="mb-5">
      <h2 style="font-size: clamp(28px, 4vw, 42px); font-weight: 600; margin-bottom: 12px; color: #111;">Must Haves</h2>
      <p style="font-size: 18px; color: #666; margin: 0 auto;">Essential gear for every outdoor adventure, handpicked by our experts.</p>
    </div>
    
    <div class="row">
      {% for product in featured_products %}
        <div class="col-sm-6 col-md-6 col-lg-4 col-xl-3">
          <div class="card h-100 border-0 position-relative">
            {% with primary_image=product.get_primary_image %}
              {% if primary_image and primary_image.image %}
                <a href="{% url 'product_detail' product.id %}" aria-label="View details for {{ product.name }}">
                  <picture>
                    <source 
                      srcset="{% if primary_image.image_thumbnail_webp %}{{ primary_image.image_thumbnail_webp.url }}{% elif product.image_thumbnail_webp %}{{ product.image_thumbnail_webp.url }}{% endif %}" 
                      type="image/webp">
                    <img class="card-img-top img-fluid" 
                      src="{% if primary_image.image_thumbnail %}{{ primary_image.image_thumbnail.url }}{% elif product.image_thumbnail %}{{ product.image_thumbnail.url }}{% else %}{{ primary_image.image.url }}{% endif %}"
                      alt="{{ product.name }}"
                      {% if forloop.counter > 6 %}loading="lazy"{% endif %}
                      decoding="async"
                      onerror="this.src='{{ MEDIA_URL }}noimage.png'">
                  </picture>
                </a>
              {% elif product.image %}
                <a href="{% url 'product_detail' product.id %}" aria-label="View details for {{ product.name }}">
                  <picture>
                    <source 
                      srcset="{% if product.image_thumbnail_webp %}{{ product.image_thumbnail_webp.url }}{% endif %}" 
                      type="image/webp">
                    <img class="card-img-top img-fluid" 
                      src="{% if product.image_thumbnail %}{{ product.image_thumbnail.url }}{% else %}{{ product.image.url }}{% endif %}"
                      alt="{{ product.name }}" 
                      {% if forloop.counter > 6 %}loading="lazy"{% endif %}
                      decoding="async"
                      onerror="this.src='{{ MEDIA_URL }}noimage.png'">
                  </picture>
                </a>
              {% else %}
                <a href="{% url 'product_detail' product.id %}" aria-label="View details for {{ product.name }}">
                  <img class="card-img-top img-fluid" 
                    src="{{ MEDIA_URL }}noimage.png" 
                    alt="{{ product.name }}" 
                    {% if forloop.counter > 6 %}loading="lazy"{% endif %}
                    decoding="async">
                </a>
              {% endif %}
            {% endwith %}
            
            {% if user.is_authenticated %}
              <form method="POST" action="{% url 'toggle_favorite' product.id %}" class="position-absolute" style="top: 10px; right: 10px;">
                {% csrf_token %}
                <button type="submit" class="btn btn-favorite rounded-circle {% if product.id in favorited_products %}favorited{% endif %}" aria-label="{% if product.id in favorited_products %}Remove {{ product.name }} from favorites{% else %}Add {{ product.name }} to favorites{% endif %}">
                  <i class="{% if product.id in favorited_products %}fas{% else %}far{% endif %} fa-heart" aria-hidden="true"></i>
                </button>
              </form>
            {% endif %}
            
            <div class="card-body pb-0">
              <p class="mb-0">{{ product.name }}</p>
            </div>
            
            <div class="card-footer bg-white pt-0 border-0 text-left">
              <div class="row">
                <div class="col">
                  <p class="lead mb-0 text-left font-weight-bold">${{ product.price }}</p>
                  {% if product.category %}
                  <p class="small mt-1 mb-0">
                    <a class="text-muted" href="{% url 'products' %}?category={{ product.category.name|urlencode }}" aria-label="View all {{ product.category.friendly_name }} products">
                      <i class="fas fa-tag mr-1" aria-hidden="true"></i>{{ product.category.friendly_name }}
                    </a>
                  </p>
                  {% endif %}
                  {% if product.average_rating > 0 %}
                    <small class="text-muted">
                      <span class="star-icon-pointy" aria-hidden="true">
                        <svg><use href="#star-pointy"></use></svg>
                      </span>{{ product.average_rating|floatformat:1 }} / 5
                    </small>
                  {% else %}
                    <small class="text-muted">No Rating</small>
                  {% endif %}
                  {% if request.user.is_superuser %}
                    <small class="ml-3">
                      <a href="{% url 'edit_product' product.id %}" aria-label="Edit {{ product.name }}">Edit</a> | 
                      <a class="text-danger" href="{% url 'delete_product' product.id %}" aria-label="Delete {{ product.name }}">Delete</a>
                    </small>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
        {% if forloop.counter|divisibleby:1 %}
          <div class="col-12 d-sm-none mb-5">
            <hr>
          </div>
        {% endif %}                        
        {% if forloop.counter|divisibleby:2 %}
          <div class="col-12 d-none d-sm-block d-md-block d-lg-none mb-5">
            <hr>
          </div>
        {% endif %}
        {% if forloop.counter|divisibleby:3 %}
          <div class="col-12 d-none d-lg-block d-xl-none mb-5">
            <hr>
          </div>
        {% endif %}
        {% if forloop.counter|divisibleby:4 %}
          <div class="col-12 d-none d-xl-block mb-5">
            <hr>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    
    <!-- View All Products Button -->
    <div class="text-center mt-5">
      <a href="{% url 'products' %}" class="btn btn-outline-black" style="padding: 12px 24px; font-weight: 600; text-decoration: none; border-radius: 6px;">View All Products</a>
    </div>
  </div>
</section>
{% endif %}
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<style>
/* Custom responsive grid for 5 products per row on large screens */
@media (min-width: 992px) {
  .col-lg-2-4 {
    flex: 0 0 20%;
    max-width: 20%;
  }
}
@media (min-width: 1200px) {
  .col-xl-2-4 {
    flex: 0 0 20%;
    max-width: 20%;
  }
}
</style>
{% endblock %}